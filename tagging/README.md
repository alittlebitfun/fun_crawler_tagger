# 标签管理模块 (Tagging)

专门用于管理和处理图片标签的Python工具集，提供可视化的标签编辑和管理功能。

## 📁 文件说明

- `tag_processor_gradio.py` - **主要标签处理工具**，基于Gradio的Web界面
- `excel_to_txt.py` - Excel文件转TXT格式工具
- `预设/` - 预设标签分类文件
  - `人物特征.txt` - 人物特征相关标签
  - `服装.txt` - 服装相关标签
  - `饰品.txt` - 饰品相关标签
- `tag_backup/` - 自动备份目录
- `数据集.txt` - 数据集说明文档
- `数据集.xlsx` - 数据集Excel文件

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install gradio pandas openpyxl
```

### 2. 启动Web界面

```bash
python tag_processor_gradio.py
```

访问 `http://localhost:7860` 使用界面

### 3. Excel转TXT

```bash
python excel_to_txt.py
```

## 🎯 主要功能

### 📊 标签统计与分析
- 统计所有txt文件中的标签出现次数
- 按出现频率排序显示
- 支持子文件夹递归统计
- 实时更新统计结果

### 🗑️ 批量删除标签
- **手动选择删除**：从统计结果中选择要删除的标签
- **预设删除**：使用预设分类批量删除标签
- **预览功能**：删除前预览影响范围
- **安全备份**：操作前自动备份所有文件

### 🔧 文本处理功能
- **添加前缀/后缀**：为整个文本内容添加前缀或后缀
- **标签替换**：精确替换单个标签
- **文本替换**：整体搜索替换文本内容
- **批量处理**：支持大量文件同时处理

## ⚙️ 配置说明

### 默认路径设置
在 `tag_processor_gradio.py` 中修改默认数据集路径：
```python
self.default_path = r"C:\Users\DINGDASHI\Pictures\模型\code\datasets\data\surtr_dataset"
```

### 预设标签管理
在 `预设/` 目录中添加自定义预设文件：
```
预设/
├── 人物特征.txt
├── 服装.txt
├── 饰品.txt
└── 自定义分类.txt  # 添加新的预设文件
```

### 备份设置
备份文件自动保存到 `tag_backup/` 目录：
```
tag_backup/
├── dataset_backup_20251001_153512/
├── dataset_backup_20251001_153520/
└── ...
```

## 🎨 界面功能详解

### 标签统计与批量删除
1. **目录路径**：选择要处理的txt文件目录
2. **包含子文件夹**：是否递归搜索子文件夹
3. **统计标签**：分析并显示所有标签统计
4. **选择删除**：从统计结果中选择要删除的标签
5. **预览删除**：查看删除操作的影响范围
6. **确认删除**：执行删除操作并自动备份

### 预设删除
1. **预设选择**：从预设分类中选择要删除的标签组
2. **预览删除**：查看预设删除的影响范围
3. **确认删除**：执行预设删除操作

### 其他功能
1. **文本前后缀**：为整个文本内容添加前缀或后缀
2. **标签替换**：精确替换单个标签
3. **文本替换**：整体搜索替换文本内容

## 📝 使用示例

### 1. 统计标签
```
1. 输入目录路径：C:\data\my_dataset
2. 勾选"包含子文件夹"
3. 点击"统计标签"
4. 查看统计结果
```

### 2. 批量删除标签
```
1. 从统计结果中选择要删除的标签
2. 点击"预览删除"查看影响
3. 确认无误后点击"确认删除"
4. 查看操作结果和备份位置
```

### 3. 使用预设删除
```
1. 选择预设分类（如"服装"）
2. 点击"预览删除"
3. 确认后执行删除
```

### 4. 添加前缀后缀
```
1. 输入前缀：如"character_"
2. 输入后缀：如"_style"
3. 点击"添加前缀/后缀"
```

## 🔧 高级功能

### 递归处理
- 支持处理子文件夹中的所有txt文件
- 保持原有的文件夹结构
- 备份时也保持文件夹结构

### 安全备份
- 每次操作前自动创建备份
- 备份文件名包含时间戳和操作描述
- 支持恢复误操作

### 批量操作
- 支持处理大量文件
- 实时显示处理进度
- 详细的错误报告

## ⚠️ 注意事项

1. **备份重要**：重要操作前建议手动备份
2. **路径正确**：确保输入的数据集路径正确
3. **文件格式**：确保txt文件格式正确（逗号分隔标签）
4. **权限问题**：确保有文件读写权限
5. **编码问题**：文件使用UTF-8编码

## 🛠️ 故障排除

### 界面无法启动
```bash
# 检查端口是否被占用
netstat -an | findstr 7860
```

### 文件读取错误
- 检查文件路径是否正确
- 确保文件编码为UTF-8
- 检查文件权限

### 备份失败
- 确保有足够的磁盘空间
- 检查备份目录权限
- 确保目标目录存在

## 📈 性能优化

- 处理大量文件时建议分批处理
- 使用SSD存储提升I/O性能
- 定期清理备份文件释放空间
- 关闭不必要的程序释放内存

## 🔗 相关资源

- [Gradio文档](https://gradio.app/docs/)
- [Pandas文档](https://pandas.pydata.org/docs/)
- [OpenPyXL文档](https://openpyxl.readthedocs.io/)

## 📊 数据格式说明

### TXT文件格式
```
tag1, tag2, tag3, tag4
```
- 使用逗号分隔标签
- 支持空格和换行
- UTF-8编码

### Excel文件格式
- 第一列：文本内容
- 第二列：文件名
- 支持.xlsx和.xls格式
